{% extends '_layout2.html' %}

{% block title %}SPLOT{% endblock %}

{% block body %}

    <!--prompt user to login-->
    <h1 class="mb-3">Welcome to SPLOT</h1>
    <p>Please log in or sign up to talk about all the good tunes out today</p>
        
    <!--signin and signup buttons-->
    <div class="container" style="margin-top: 30%">
        <div class="row">
            <!--signup button-->
            <div class="col">
                <form action="/signup" method="GET">
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </form>
            </div>
            
            <!--signin button-->
            <div class="col">
                <form action="/signin" method="GET"> 
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </form>
            </div>


            <div class="col">
                <script src="https://apis.google.com/js/platform.js" async defer></script>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
                <meta name="google-signin-client_id" content="912544824526-5tv415qgqhecnatj1cgudd09cklel7vq.apps.googleusercontent.com">

                <div class="g-signin2" data-onsuccess="onSignIn" ></div>
                
                <form action="/in" method="POST">
                    <input type="hidden" id="input" name="input" value="" >
                </form>

                <script name = "info">
                    function onSignIn(googleUser) {
                        var data = googleUser.getAuthResponse().id_token;
                        var profile = googleUser.getBasicProfile();
                        var name = profile.getName();
                        var email = profile.getEmail();
                        var img = profile.getImageUrl();
                        
                        console.log("ID Token: " + data);
                        console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
                        console.log('Name: ' + profile.getName());
                        console.log('Image URL: ' + profile.getImageUrl());
                        console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
                        //request.open('POST', '/', true);

                        console.log("HERE" +data);

                        document.getElementById("input").value = data;
                        
                        console.log( document.getElementById("input").value);

                        var auth2 = gapi.auth2.getAuthInstance();
                        auth2.signOut().then(function () {
                        console.log('User signed out.');
                        });

                        $.ajax({
                            type : "POST",
                            url : '/google/in',
                            dataType : 'json',
                            data : JSON.stringify({
                                googleIdToken : email
                            }),
                            contentType : 'application/json',

                            // if a gmail account is selected
                            success: function(response) {
                                // if the account is already made then start session and go home
                                if(response == '1'){
                                    alert('already user');
                                    window.location.pathname = "/home";
                                    return;
                                }
                                
                                // if the account is not made then direct to the google signup page
                                window.location.pathname = "/google/signup";
                        
                            },
                        })
                    }
                    
                </script>
            </div>



        </div>
    </div>

{% endblock %}